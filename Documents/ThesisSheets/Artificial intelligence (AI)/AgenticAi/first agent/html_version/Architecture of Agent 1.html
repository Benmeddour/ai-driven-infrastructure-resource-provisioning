<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture: Validation & Data Collection Agent</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            color: #34495e;
            max-width: 950px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f8f9fa;
        }
        
        h1,
        h2,
        h3 {
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        
        h1 {
            text-align: center;
            border-bottom: 3px solid #3498db;
            font-size: 2.5em;
        }
        
        h2 {
            font-size: 1.8em;
        }
        
        h3 {
            font-size: 1.4em;
            border-bottom: none;
            display: flex;
            align-items: center;
        }
        
        h3 .icon {
            font-size: 1.5em;
            margin-right: 15px;
        }
        
        .introduction {
            background-color: #ebf5fb;
            border: 1px solid #aed6f1;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .tool-card {
            background-color: #ffffff;
            border: 1px solid #e5e7e9;
            border-left: 5px solid #3498db;
            padding: 20px 25px;
            margin-top: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .workflow-summary {
            background-color: #e8f8f5;
            border: 1px solid #a3e4d7;
            border-left: 5px solid #16a085;
            padding: 20px 25px;
            margin-top: 30px;
            border-radius: 8px;
        }
        
        code {
            background-color: #ecf0f1;
            padding: 4px 7px;
            border-radius: 4px;
            font-family: "Courier New", Courier, monospace;
            color: #c0392b;
            font-size: 0.95em;
        }
        
        ul,
        ol {
            padding-left: 25px;
        }
        
        li {
            margin-bottom: 10px;
        }
        
        strong {
            color: #2980b9;
        }
    </style>
</head>

<body>

    <h1>Architecture of the Validation & Data Collection Agent</h1>

    <div class="introduction">
        <p>This document details the architecture of the <strong>Chat Validator and Data Collector Agent</strong>. This agent functions as the <strong>Intelligent Gateway</strong> to our entire automated provisioning system. Its design philosophy is to robustly
            handle ambiguity and transform unstructured user requests into a structured, data-rich payload for downstream processing.</p>
    </div>

    <h2>The Core Engine: Conversational AI Pipeline</h2>
    <div class="tool-card">
        <h3><span class="icon">üß†</span> Conversational Validation & State Machine</h3>
        <p>The heart of the agent is its core LLM-driven logic, which functions as a stateful conversational engine. It is responsible for guiding a conversation from ambiguity to a validated, actionable state.</p>
        <ul>
            <li><strong>Intent Recognition:</strong> It first classifies the user's input to confirm a provisioning intent. Non-provisioning requests are gracefully deflected.</li>
            <li><strong>Contextual Platform Identification:</strong> It employs a sophisticated, multi-tiered logic to identify the target platform (Proxmox or Kubernetes), moving from explicit keywords to technical artifacts and finally to architectural
                inference, mimicking the reasoning of a human expert.</li>
            <li><strong>Entity Extraction and Validation:</strong> The engine actively parses the conversation for required parameters (e.g., VM names, container images). This is not a one-shot process.</li>
            <li><strong>Short-Term Memory for Dialogue Management:</strong> The agent maintains the context of the conversation. This is crucial for multi-turn interactions, allowing it to ask clarifying questions (e.g., "What port does that container expose?")
                without losing the original request context.</li>
        </ul>
    </div>

    <h2>The Data Ingestion Toolkit: System & Application Interfaces</h2>
    <div class="tool-card">
        <h3><span class="icon">üõ†Ô∏è</span> Infrastructure API Clients</h3>
        <p>Once the platform is identified, the agent utilizes a suite of tools to query the "ground truth" of the infrastructure. These are direct, authenticated API clients, not inferential models.</p>
        <ul>
            <li><strong>Proxmox API Client:</strong> Fetches the real-time state of the Proxmox cluster, including node status, resource capacity/load, available storage pools, and a manifest of existing templates and ISO images.</li>
            <li><strong>Kubernetes API Client:</strong> Interacts with the Kubernetes API server to gather data on node status, allocatable resources, namespace-specific constraints (<code>ResourceQuotas</code>, <code>LimitRanges</code>), and available <code>StorageClasses</code>.</li>
        </ul>
    </div>

    <h2>The Output Interface: Structured Data Serialization</h2>
    <div class="tool-card">
        <h3><span class="icon">üìÑ</span> JSON Formatter & Serializer</h3>
        <p>This is the final, critical step in the agent's pipeline. It ensures a clean hand-off to the next agent in the system.</p>
        <ul>
            <li><strong>Function:</strong> Consolidates all validated parameters from the conversation, the state data from the infrastructure APIs.</li>
            <li><strong>Purpose:</strong> To serialize this aggregated data into a strictly-defined, machine-readable JSON object. This structured format eliminates any ambiguity, allowing the downstream analysis and planning agents to operate on a predictable
                and reliable data model.</li>
        </ul>
    </div>

    <div class="workflow-summary">
        <h2>Workflow Summary: From Chat to JSON</h2>
        <ol>
            <li><strong>Receive & Validate:</strong> The user sends a natural language request. The <strong>Core Engine</strong> validates the intent and begins a dialogue if necessary.</li>
            <li><strong>Identify Platform:</strong> The engine determines the target is either Proxmox or Kubernetes.</li>
            <li><strong>Gather Infrastructure State:</strong> The relevant <strong>API Client</strong> is triggered to pull the current state of the target cluster.</li>
            <li><strong>Consolidate & Format:</strong> The <strong>JSON Formatter</strong> takes all collected data and serializes it into the final, structured output file.</li>
        </ol>
    </div>

</body>

</html>